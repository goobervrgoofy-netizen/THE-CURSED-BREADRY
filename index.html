<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Cursed Bakery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #ffe6c1;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      text-align: center;
      background: #d2a679;
      color: #5e3800;
      padding: 1em 0 0.5em 0;
      box-shadow: 0 2px 6px #d2a67960;
    }

    #dough-coins {
      font-size: 1.4em;
      margin-top: 0.5em;
    }

    main {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2em;
      margin: 2em auto;
      max-width: 1000px;
    }

    .game-area {
      flex: 1 1 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sourdough-click-area {
      position: relative;
      display: inline-block;
      margin: 2em 0;
      cursor: pointer;
    }

    .bread-btn {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      position: relative;
      cursor: pointer;
      border-radius: 24px;
      box-shadow: 0 4px 14px #5e3800, 0 2px 2px #fffbe6;
      transition: box-shadow 0.13s, transform 0.11s;
      display: block;
      outline: none;
    }
    .bread-btn:active {
      box-shadow: 0 1px 7px #5e3800;
      transform: scale(0.97);
    }
    .bread-btn img {
      display: block;
      width: 270px;
      height: 270px;
      object-fit: cover;
      border-radius: 24px;
      transition: filter 0.2s, transform 0.2s;
      background: #fff8e1;
    }
    .bread-btn.bounce img {
      animation: bounce 0.4s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @keyframes bounce {
      0%   { transform: scale(1) translateY(0); }
      30%  { transform: scale(1.1, 0.9) translateY(-10px);}
      50%  { transform: scale(0.93, 1.09) translateY(-22px);}
      70%  { transform: scale(1.05, 0.95) translateY(-8px);}
      100% { transform: scale(1) translateY(0);}
    }

    .upgrades {
      flex: 1 1 260px;
      background: #fffbe6;
      border-radius: 15px;
      box-shadow: 0 2px 8px #d2a67930;
      padding: 1em 2em 2em 2em;
      text-align: center;
      min-width: 220px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .upgrades button {
      display: block;
      width: 100%;
      margin: 0.5em 0;
      padding: 0.8em;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      background: #e9c46a;
      color: #5e3800;
      cursor: pointer;
      transition: background 0.2s;
    }

    .upgrades button:disabled {
      background: #f2e4c2;
      cursor: not-allowed;
    }

    .narrative {
      flex-basis: 100%;
      max-width: 600px;
      margin: 2em auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 2px 8px #d2a67930;
      padding: 1.5em 2em;
    }

    #journal {
      min-height: 50px;
      margin-bottom: 1em;
    }

    #achievements ul {
      padding-left: 1.2em;
      margin: 0.5em 0 0 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>The Cursed Bakery</h1>
    <h2>Click the Ever-rising Sourdough to flatten it!</h2>
    <div id="dough-coins">Dough-coins: <span id="coin-count">0</span></div>
  </header>
  <main>
    <div class="game-area">
      <div class="sourdough-click-area" id="sourdough-area">
        <button class="bread-btn" id="click-btn" aria-label="Click the sourdough">
          <img src="bred.jpeg" id="sourdough" alt="Ever-rising Sourdough - Click me!">
        </button>
      </div>
    </div>
    <section class="upgrades" id="upgrades-section">
      <h3>Upgrades</h3>
      <!-- Upgrade buttons will be injected here by JS -->
    </section>
    <section class="narrative">
      <h3>Bakery Journal</h3>
      <div id="journal">
        <p><em>"A strange bubbling from the dough again today..."</em></p>
      </div>
      <div id="achievements">
        <h4>Achievements</h4>
        <ul id="ach-list"></ul>
      </div>
    </section>
  </main>
  <script>
    let coins = 0;
    let coinsPerClick = 1;
    let coinsPerSecond = 0;
    let incomeMultiplier = 1;
    let achievements = [];
    const boughtUpgrades = {};

    // List of all upgrades (name, cost, effect, narrative, type, amount)
    const upgrades = [
      {id:"yeast", name:"Magic Yeast Sprinkles", cost:10, type:"click", amount:1, narrative:"A sprinkle of magic yeast... the dough quivers!"},
      {id:"pin", name:"All-Powerful Rolling Pin", cost:50, type:"click", amount:5, narrative:"The All-Powerful Rolling Pin crushes the dough's will!"},
      {id:"gnomes", name:"Team of Baker Gnomes", cost:100, type:"auto", amount:1, narrative:"Tiny baker gnomes emerge and start smacking the dough on your behalf!"},
      {id:"oven", name:"Enchanted Oven", cost:300, type:"mult", amount:2, narrative:"The enchanted oven radiates warmth. All doughs flatten faster!"},
      {id:"apprentice", name:"Ghostly Apprentice", cost:500, type:"click", amount:10, narrative:"A ghostly apprentice appears, helping with every click!"},
      {id:"fairy", name:"Flour Fairy", cost:1000, type:"auto", amount:5, narrative:"The Flour Fairy flutters by, spreading flour and joy!"},
      {id:"curse", name:"Lift the Curse", cost:5000, type:"mult", amount:3, narrative:"A strange energy lifts from the bakery. All income triples!"},
      {id:"owl", name:"Nocturnal Oven Owl", cost:7500, type:"auto", amount:10, narrative:"The oven owl keeps watch through the night, flattening dough while you sleep."},
      {id:"cat", name:"Cat on the Counter", cost:12000, type:"click", amount:25, narrative:"The cat bats at the dough, making it rise and fall in strange ways."},
      {id:"mill", name:"Haunted Flour Mill", cost:20000, type:"auto", amount:40, narrative:"Ghosts at the mill grind flour with supernatural speed!"},
      {id:"grandma", name:"Grandma's Blessing", cost:30000, type:"mult", amount:2, narrative:"A spectral grandma appears, doubling your baking skills."},
      {id:"baker", name:"Master Baker's Spirit", cost:40000, type:"click", amount:100, narrative:"The master baker's spirit guides your hands. Clicks are much mightier!"},
      {id:"witch", name:"Witch's Cauldron", cost:50000, type:"auto", amount:100, narrative:"A bubbling cauldron auto-flattens dough with magical force."},
      {id:"chicken", name:"Golden Chicken", cost:65000, type:"auto", amount:250, narrative:"A golden chicken lays eggs that somehow multiply your dough-coins!"},
      {id:"star", name:"Lucky Star", cost:80000, type:"mult", amount:2, narrative:"A shooting star doubles your entire bakery's output."},
      {id:"assistant", name:"Spectral Assistant", cost:95000, type:"auto", amount:500, narrative:"A spectral assistant tirelessly flattens dough for you."},
      {id:"robot", name:"Breadbot 3000", cost:110000, type:"click", amount:500, narrative:"Breadbot 3000 powers up and supercharges your clicks!"},
      {id:"soul", name:"Soul Contract", cost:130000, type:"mult", amount:2, narrative:"You sign a dubious contract. All your income is doubled, at what cost?"},
      {id:"pigeon", name:"Messenger Pigeon", cost:150000, type:"auto", amount:1000, narrative:"A fleet of pigeons delivers your dough far and wide, earning more coins!"},
      {id:"time", name:"Time Loop", cost:180000, type:"mult", amount:2, narrative:"Time itself bends, doubling your production speed!"},
      {id:"portal", name:"Portal to Bread Dimension", cost:210000, type:"auto", amount:2500, narrative:"Bread pours in from another dimension!"},
      {id:"midas", name:"Midas Touch", cost:250000, type:"click", amount:2500, narrative:"Everything you touch turns to dough-coins!"},
      {id:"phoenix", name:"Phoenix Crumbs", cost:300000, type:"auto", amount:5000, narrative:"A phoenix's crumbs fall and instantly bake into coins."},
      {id:"twin", name:"Evil Twin", cost:370000, type:"click", amount:5000, narrative:"Your evil twin helps you flatten dough, suspiciously well..."},
      {id:"rune", name:"Rune of Infinite Yeast", cost:450000, type:"mult", amount:3, narrative:"A rune imbues your bakery, tripling all output!"},
      {id:"crown", name:"Crown of the Flour King", cost:600000, type:"auto", amount:10000, narrative:"The Flour King bestows his crown, blessing your bakery with endless bounty."},
      {id:"goblin", name:"Goblin Union", cost:800000, type:"auto", amount:20000, narrative:"A goblin union organizes your bakery, production skyrockets!"},
      {id:"god", name:"The Bread God", cost:1000000, type:"mult", amount:5, narrative:"The Bread God smiles upon you, quintupled output for all eternity."}
    ];

    const coinCountEl = document.getElementById('coin-count');
    const sourdough = document.getElementById('sourdough');
    const clickBtn = document.getElementById('click-btn');
    const upgradesSection = document.getElementById('upgrades-section');
    const journal = document.getElementById('journal');
    const achList = document.getElementById('ach-list');

    // Render upgrades as actual buttons and keep their state up to date
    function renderUpgrades() {
      upgradesSection.querySelectorAll('button.upgrade-btn').forEach(btn => btn.remove());
      for (const upgrade of upgrades) {
        const btn = document.createElement('button');
        btn.className = 'upgrade-btn';
        btn.id = 'upgrade-' + upgrade.id;
        btn.textContent = `${upgrade.name} (${upgrade.type === 'click' ? '+' : upgrade.type === 'auto' ? '+' : 'x'}${upgrade.amount}${upgrade.type === 'mult' ? ' income' : upgrade.type === 'auto' ? '/sec' : '/click'}, Cost: ${upgrade.cost})`;
        btn.disabled = boughtUpgrades[upgrade.id] || coins < upgrade.cost;
        btn.addEventListener('click', () => buyUpgrade(upgrade));
        upgradesSection.appendChild(btn);
      }
    }

    function updateUpgradeButtons() {
      for (const upgrade of upgrades) {
        const btn = document.getElementById('upgrade-' + upgrade.id);
        if (btn) btn.disabled = boughtUpgrades[upgrade.id] || coins < upgrade.cost;
      }
    }

    function buyUpgrade(upgrade) {
      if (boughtUpgrades[upgrade.id] || coins < upgrade.cost) return;
      updateCoins(-upgrade.cost);
      if (upgrade.type === "click") coinsPerClick += upgrade.amount;
      if (upgrade.type === "auto") coinsPerSecond += upgrade.amount;
      if (upgrade.type === "mult") incomeMultiplier *= upgrade.amount;
      boughtUpgrades[upgrade.id] = true;
      addJournal(`"${upgrade.narrative}"`);
      renderUpgrades(); // Re-render to refresh the state and buttons
    }

    function updateCoins(val) {
      coins += val;
      if (coins < 0) coins = 0;
      coinCountEl.textContent = coins;
      checkAchievements();
      updateUpgradeButtons();
    }

    function checkAchievements() {
      if (coins >= 10 && !achievements.includes('First Loaf')) {
        unlockAchievement('First Loaf', 'You flattened your first 10 doughs!');
        addJournal("\"The dough seems to grow more lively with every smack...\"");
      }
      if (coins >= 100 && !achievements.includes('Tiny Hands')) {
        unlockAchievement('Tiny Hands', 'You have enough for a Team of Gnomes!');
        addJournal("\"Did I just see something scurry behind the flour sacks?\"");
      }
      if (coins >= 10000 && !achievements.includes('Legendary Baker')) {
        unlockAchievement('Legendary Baker', 'You have become a legend among bakers!');
        addJournal("\"Your story will be told for generations.\"");
      }
      if (coins >= 1000000 && !achievements.includes('Bread Godhood')) {
        unlockAchievement('Bread Godhood', 'You have reached the pinnacle of bakery legend!');
        addJournal("\"All dough bows to your divine will.\"");
      }
    }

    function unlockAchievement(name, desc) {
      achievements.push(name);
      const li = document.createElement('li');
      li.innerHTML = `<strong>${name}</strong>: ${desc}`;
      achList.appendChild(li);
    }

    function addJournal(text) {
      const p = document.createElement('p');
      p.innerHTML = `<em>${text}</em>`;
      journal.appendChild(p);
    }

    function flattenDough() {
      updateCoins(coinsPerClick * incomeMultiplier);
      clickBtn.classList.remove('bounce');
      void clickBtn.offsetWidth;
      clickBtn.classList.add('bounce');
      let hue = Math.min(30 + coins / 8, 70);
      sourdough.style.filter = `hue-rotate(${hue}deg) brightness(1.08)`;
      setTimeout(() => sourdough.style.filter = '', 300);
    }

    clickBtn.addEventListener('click', (e) => {
      e.preventDefault();
      flattenDough();
    });
    clickBtn.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        flattenDough();
      }
    });

    setInterval(() => {
      if (coinsPerSecond > 0) {
        updateCoins(coinsPerSecond * incomeMultiplier);
      }
    }, 1000);

    renderUpgrades();
    setInterval(updateUpgradeButtons, 200);
  </script>
</body>
</html>
